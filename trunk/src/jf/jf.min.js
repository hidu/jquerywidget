(function(a){window.jf=window.jf||{};if(window.jf.version){return}window.jf={version:"20120421",toString:function(){return"form kit "+this.version},loading:function(d){var b=a(d),c=b.height();if(c<70){c=80}else{if(c>500){c=300}}b.empty().html("<div class='jf_loading' style='height:"+c+"px;padding-top:"+(c-70)/2+"px;'>正在加载...<div>&nbsp;</div></div>")},form:function(e,f,j,c){if(a.isFunction(f)){c=j;j=f;f=null}if(!a.isFunction(j)){c=j;j=""}c=a.extend({},{dataType:null,delay:0,validate:true,timeout:30000,validate:{},before:null},c||{});var h=this,b=a(e),g=function(l){b.find(":submit").attr("disabled",!l)};b.find(":reset").click(function(){var l=a(this).attr("title");if(l.length&&false===confirm(l)){return false}g(true);b.resetForm();b.find(":input").trigger("reset");return false});b.find(":text").bind("change",function(){a(this).val(a.trim(a(this).val()))});var d=function(n,m,l){if(c.before){if(c.dataType==null){c.dataType="json"}if(false===c.before.call(m)){return false}}g(false);f&&h.loading(f)};var k={target:f,beforeSubmit:d,timeout:c.timeout,dataType:c.dataType,success:function(l){g(true);a.isFunction(j)&&j.call(b,l)},beforeSend:function(l){try{l.setRequestHeader("jf",window.screen.height+"/"+window.screen.width)}catch(m){}},error:function(m,l,n){g(true);f&&a(f).html("load failed "+m.responseText)}};function i(){if(c.validate!==false&&a.validator){var l={submitHandler:function(){b.ajaxSubmit(k)}};a.extend(l,c.validate);b.validate(l)}else{b.submit(function(){a(this).ajaxSubmit(k);return false})}}if(c.delay){a().ready(function(){setTimeout(i,c.delay)})}else{i()}return b},ajaxLink:function(e,b){var c=this,d=a(b);if(!d.size()){return false}a(e).die("click").live("click",function(){var f=a(this).attr("href");if(!f){return}c.centerIt(d);c.loading(b);d.attr("rel",f).load(f);return false})},pager:function(c,b){this.ajaxLink(a(c||".pager").find("a"),b)},centerIt:function(c){var d=a(c).offset().top;var b=a(window).height();if(d>window.scrollY+0.75*b||d<window.scrollY){window.scrollTo(window.scrollX,d-20)}},checkAll:function(c,b){if(typeof b=="object"){if(a(b).attr("checked")){b=1}else{b=0}}if(0==b){a(c).attr("checked",false)}else{if(1==b){a(c).attr("checked",true)}else{if(2==b){a(c).each(function(){a(this).attr("checked",!(a(this).attr("checked")))})}else{if(9==b){return a.map(a(c+":checked"),function(d){return a(d).val()})}}}}},trSelect:function(d){var c=a(d||"table"),b=function(){c.find("tr").removeClass("jf_select");a(this).parents("tr").addClass("jf_select")};c.find("tbody td *").bind("click",b);c.find("tbody td").bind("dblclick",b)},ajaxFile:function(d,h,i,f){f=f||{};f.fileExt=f.fileExt||["bmp","jpg","jpeg","png","gif"];var k=function(o){var m=o.lastIndexOf("."),n=m>=0?o.substring(m+1,o.length).toLowerCase():"";var l=a.inArray(n,f.fileExt)>-1;if(!l){alert("文件:\n"+o+"\n不被支持！\n请选择后缀为"+f.fileExt.join()+"的文件")}return l};var b=a(d),e=b.find(":file"),g=e[0],c=function(){if(g.multiple){for(var l=0;l<g.files.length;l++){var m=g.files[l].name;if(!k(m)){e.val("");return false}}}else{if(!k(e.val())){e.val("");return false}}return true};var j=true;e.change(function(){if(e.val().length>0){j=c()}});b.ajaxForm({beforeSubmit:function(o,m,l){var n=e.val();if(n.length<1){alert("请选择要上传的文件");return false}if(false===c()){return false}if((typeof h=="function")&&false===h.call(m)){return false}},dataType:f.dataType||"json",success:function(l){if(typeof i=="function"){i.call(b,l)}},error:function(m,n,l){alert("something wrong!\n\n"+m.responseText)}});if(f.autoSubmit){e.change(function(){j&&e.val().length&&b.submit()})}return b},optionToSelect:function(c,d,b){a('<option value="'+c+'">'+d+"</option>").appendTo(b)},relation:function(g,d,c,b){var e=a(d),f=this;a(g).change(function(){var i=a(this).val(),j=e.find("option:selected").val(),h="";if(c&&(typeof c)=="string"){a.getJSON(c+i,function(l){h=l;k()})}else{h=c?(c[i]||""):"";k()}function k(){e.empty();b&&f.optionToSelect("",b,e);a.each(h,function(m,l){f.optionToSelect(m,l,e)});if(j&&h[j]){e.val(j)}e.change()}}).change()},findByName:function(b,c){return jQuery(document.getElementsByName(b),c||"*").map(function(d,e){return e.name==b&&e||null})}}})(jQuery);